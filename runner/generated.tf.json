{
  "module": {
    "s3_uploads": {
      "source": "../modules/s3-secure",
      "app": "myapp",
      "env": "dev",
      "name": "uploads",
      "versioning": false,
      "lifecycle_days": 90,
      "block_public_access": true,
      "server_access_logs": false
    },
    "s3_static": {
      "source": "../modules/s3-secure",
      "app": "myapp",
      "env": "dev",
      "name": "static",
      "versioning": false,
      "lifecycle_days": 90,
      "block_public_access": false,
      "server_access_logs": false
    },
    "irsa": {
      "source": "../modules/iam/irsa-role",
      "app": "myapp",
      "env": "dev",
      "namespace": "myapp",
      "oidc_provider_arn": "arn:aws:iam::123456789012:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/EXAMPLE",
      "oidc_provider_url": "example.oidc.eks.us-east-1.amazonaws.com/id/EXAMPLE",
      "grants": {
        "s3": [
          "${module.s3_uploads.arn}",
          "${module.s3_static.arn}"
        ],
        "rds_secrets": [
          "${aws_db_instance.rds_main.master_user_secret[0].secret_arn}"
        ],
        "secrets": [
          "${aws_secretsmanager_secret.secret_app_secrets.arn}"
        ]
      }
    }
  },
  "output": {
    "irsa_role_arn": {
      "value": "${module.irsa.role_arn}"
    }
  },
  "resource": {
    "aws_ssm_parameter": {
      "_apps_dev_myapp_s3_uploads_name": {
        "name": "/apps/dev/myapp/s3/uploads/name",
        "type": "String",
        "value": "${module.s3_uploads.name}",
        "overwrite": true,
        "tags": {
          "ManagedBy": "golden-platform"
        }
      },
      "_apps_dev_myapp_s3_static_name": {
        "name": "/apps/dev/myapp/s3/static/name",
        "type": "String",
        "value": "${module.s3_static.name}",
        "overwrite": true,
        "tags": {
          "ManagedBy": "golden-platform"
        }
      },
      "_apps_dev_myapp_rds_main_endpoint": {
        "name": "/apps/dev/myapp/rds/main/endpoint",
        "type": "String",
        "value": "${aws_db_instance.rds_main.endpoint}",
        "overwrite": true,
        "tags": {
          "ManagedBy": "golden-platform"
        }
      },
      "_apps_dev_myapp_secrets_app_secrets_arn": {
        "name": "/apps/dev/myapp/secrets/app-secrets/arn",
        "type": "String",
        "value": "${aws_secretsmanager_secret.secret_app_secrets.arn}",
        "overwrite": true,
        "tags": {
          "ManagedBy": "golden-platform"
        }
      },
      "_apps_dev_myapp_irsa_myapp_arn": {
        "name": "/apps/dev/myapp/irsa/myapp/arn",
        "type": "String",
        "value": "${module.irsa.role_arn}",
        "overwrite": true,
        "tags": {
          "ManagedBy": "golden-platform"
        }
      }
    },
    "aws_db_instance": {
      "rds_main": {
        "identifier": "myapp-main-dev",
        "engine": "postgres",
        "engine_version": "15.4",
        "instance_class": "db.t3.micro",
        "allocated_storage": 20,
        "storage_type": "gp2",
        "storage_encrypted": true,
        "db_name": "main",
        "username": "admin",
        "manage_master_user_password": true,
        "multi_az": false,
        "backup_retention_period": 1,
        "backup_window": "03:00-04:00",
        "maintenance_window": "sun:04:00-sun:05:00",
        "deletion_protection": false,
        "skip_final_snapshot": true,
        "tags": {
          "App": "myapp",
          "Env": "dev",
          "ManagedBy": "golden-platform"
        }
      }
    },
    "aws_secretsmanager_secret": {
      "secret_app_secrets": {
        "name": "/apps/dev/myapp/secrets/app-secrets",
        "description": "Application secrets and API keys",
        "tags": {
          "App": "myapp",
          "Env": "dev",
          "ManagedBy": "golden-platform"
        }
      }
    }
  }
}