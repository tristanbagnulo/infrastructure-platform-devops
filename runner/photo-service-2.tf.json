{
  "module": {
    "s3_photos": {
      "source": "../modules/s3-secure",
      "app": "photo-service",
      "env": "dev",
      "name": "photos",
      "versioning": false,
      "lifecycle_days": 90,
      "block_public_access": true,
      "server_access_logs": false
    },
    "irsa": {
      "source": "../modules/iam/irsa-role",
      "app": "photo-service",
      "env": "dev",
      "namespace": "photo-service",
      "oidc_provider_arn": "arn:aws:iam::123456789012:oidc-provider/example",
      "oidc_provider_url": "example",
      "grants": {
        "s3": [
          "${module.s3_photos.arn}"
        ],
        "rds_secrets": [
          "${aws_db_instance.rds_main.master_user_secret[0].secret_arn}"
        ],
        "secrets": [
          "${aws_secretsmanager_secret.secret_api_keys.arn}"
        ]
      }
    }
  },
  "output": {
    "irsa_role_arn": {
      "value": "${module.irsa.role_arn}"
    }
  },
  "resource": {
    "aws_ssm_parameter": {
      "_apps_dev_photo_service_s3_photos_name": {
        "name": "/apps/dev/photo-service/s3/photos/name",
        "type": "String",
        "value": "${module.s3_photos.name}",
        "overwrite": true,
        "tags": {
          "ManagedBy": "golden-platform"
        }
      },
      "_apps_dev_photo_service_rds_main_endpoint": {
        "name": "/apps/dev/photo-service/rds/main/endpoint",
        "type": "String",
        "value": "${aws_db_instance.rds_main.endpoint}",
        "overwrite": true,
        "tags": {
          "ManagedBy": "golden-platform"
        }
      },
      "_apps_dev_photo_service_secrets_api_keys_arn": {
        "name": "/apps/dev/photo-service/secrets/api-keys/arn",
        "type": "String",
        "value": "${aws_secretsmanager_secret.secret_api_keys.arn}",
        "overwrite": true,
        "tags": {
          "ManagedBy": "golden-platform"
        }
      },
      "_apps_dev_photo_service_irsa_photo_service_arn": {
        "name": "/apps/dev/photo-service/irsa/photo-service/arn",
        "type": "String",
        "value": "${module.irsa.role_arn}",
        "overwrite": true,
        "tags": {
          "ManagedBy": "golden-platform"
        }
      }
    },
    "aws_db_instance": {
      "rds_main": {
        "identifier": "photo-service-main-dev",
        "engine": "postgres",
        "engine_version": "15.4",
        "instance_class": "db.t3.micro",
        "allocated_storage": 20,
        "storage_type": "gp2",
        "storage_encrypted": true,
        "db_name": "main",
        "username": "admin",
        "manage_master_user_password": true,
        "multi_az": false,
        "backup_retention_period": 1,
        "backup_window": "03:00-04:00",
        "maintenance_window": "sun:04:00-sun:05:00",
        "deletion_protection": false,
        "skip_final_snapshot": true,
        "tags": {
          "App": "photo-service",
          "Env": "dev",
          "ManagedBy": "golden-platform"
        }
      }
    },
    "aws_secretsmanager_secret": {
      "secret_api_keys": {
        "name": "/apps/dev/photo-service/secrets/api-keys",
        "description": "Secrets for photo-service api-keys",
        "tags": {
          "App": "photo-service",
          "Env": "dev",
          "ManagedBy": "golden-platform"
        }
      }
    }
  }
}